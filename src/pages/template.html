<div class="container mx-auto px-4">

  <div class="flex flex-row justify-between items-center p-4">
    <div class="flex flex-row items-center"><img class="h-8 w-auto" src="../assets/images/heimdall.png">
      <h1 class="ml-4 text-3xl">Heimdall Monitor</h1>
    </div>
    <div class="flex flex-row items-center">
      <!-- <button class="bg-gray-200 focus:ring-gray-200 rounded-full h-7 w-7 mr-4 focus:outline-none focus:ring-2 focus:ring-opacity-50"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
        stroke="currentColor" class="h-5 mx-auto">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
      </svg></button> -->
      <div class="col-span-6 sm:col-span-3 relative"><input type="text"
          class="block w-full py-2 px-3 border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-full shadow-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm" value=""
          placeholder="Tap '/' to search" tabindex="0">
        <div class="absolute inset-y-1 right-1 flex z-1 items-center"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="h-7 mx-auto text-gray-300 dark:text-gray-600" fill="currentColor">
            <path d="M9 9a2 2 0 114 0 2 2 0 01-4 0z"></path>
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a4 4 0 00-3.446 6.032l-2.261 2.26a1 1 0 101.414 1.415l2.261-2.261A4 4 0 1011 5z" clip-rule="evenodd"></path>
          </svg></div>
      </div>
    </div>
  </div>

  <div id="globalTodayStatus" class="card mb-4 font-semibold bg-green-200 text-green-700 dark:bg-green-700 dark:text-green-200 border-green-300 dark:border-green-600">
    <div class="flex flex-row justify-between items-center">
      <div id="globalTodayStatusLabel">All Systems Operational</div>
      <div class="text-xs font-light">checked 10 sec ago</div>
    </div>
  </div>

  <% targetServices.forEach(function(targetService){ %>
  <% var length = targetService.statusDetail.length; %>
  <% var todayIncidentsCount = targetService.statusDetail[length-1].incidentsCount; %>
  <% var todayStatusColor = todayIncidentsCount==0 ? "green":"yellow"; %>
  <% var todayStatusLabel = todayIncidentsCount==0 ? "Operational":"Unstable"; %>
  <div class="card">
    <div class="flex flex-row justify-between items-center mb-2">
      <div class="flex flex-row items-center align-center">
        <div class="tooltip"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-5 mr-2 mx-auto text-blue-500 dark:text-blue-400">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
          </svg>
          <div class="content text-center transform -translate-y-1/2 top-1/2 ml-8 w-72 text-sm object-left"><%=targetService.description%></div>
        </div><span>
          <div class="text-xl"><%=targetService.label%></div>
        </span>
      </div>
      <div class="pill leading-5 bg-<%=todayStatusColor%>-200 text-<%=todayStatusColor%>-800 dark:bg-<%=todayStatusColor%>-800 dark:text-<%=todayStatusColor%>-200"><%=todayStatusLabel%></div>
    </div>
    <div class="flex flex-row items-center histogram">
      <% targetService.statusDetail.forEach(function(status){ %>
      <% var labelStatus = status.incidentsCount>0 ? status.incidentsCount+" Incidents":"All Good"; %>
      <% var labelColor = status.incidentsCount>0 ? "yellow":"green"; %>
      <div class="hitbox tooltip">
        <div class="<%=labelColor%> bar"></div>
        <div class="content text-center py-1 px-2 mt-2 left-1/2 -ml-20 w-40 text-xs"><%=status.dateString%><br><span class="font-semibold text-sm"><%=labelStatus%></span>
          <br><small><%=status.averageResponseTimeMillis%>ms</small>
        </div>
      </div>
      <% }); %>
    </div>
    <div class="flex flex-row justify-between items-center text-gray-400 text-sm">
      <div>90
        <!-- --> days ago
      </div>
      <div>Today</div>
    </div>
  </div>
  <% }); %>


</div>

<%
  function updateGlobalTodayStatus(){
    console.log(document.getElementById("globalTodayStatus"));
  }
%>
